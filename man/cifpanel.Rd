% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cifpanel.R
\name{cifpanel}
\alias{cifpanel}
\title{Arrange multiple survival/CIF plots into a panel (grid or inset)}
\usage{
cifpanel(
  formula = NULL,
  formulas = NULL,
  data = NULL,
  outcome.type = NULL,
  code.events = NULL,
  type.x = NULL,
  type.y = NULL,
  label.x = NULL,
  label.y = NULL,
  label.strata = NULL,
  limits.x = NULL,
  limits.y = NULL,
  break.x = NULL,
  break.y = NULL,
  addConfidenceInterval = NULL,
  addCensorMark = NULL,
  addCompetingRiskMark = NULL,
  addIntercurrentEventMark = NULL,
  addQuantileLine = NULL,
  rows.columns.panel = c(1, 1),
  title.panel = NULL,
  subtitle.panel = NULL,
  caption.panel = NULL,
  tag_levels.panel = NULL,
  title.plot = NULL,
  legend.position = "top",
  legend.collect = FALSE,
  use_inset_element = FALSE,
  inset.left = 0.6,
  inset.bottom = 0.05,
  inset.right = 0.98,
  inset.top = 0.45,
  inset.align_to = c("panel", "plot", "full"),
  inset.legend.position = NULL,
  print.panel = TRUE,
  filename.ggsave = NULL,
  width.ggsave = NULL,
  height.ggsave = NULL,
  dpi.ggsave = 300,
  ...
)
}
\arguments{
\item{formula}{A single model formula evaluated in \code{data}, used for all panels
when \code{formulas} is not provided.}

\item{formulas}{A list of formulas (one per panel). If provided, overrides \code{formula}.}

\item{data}{A data.frame containing variables used in the formula(s).}

\item{outcome.type}{Optional vector/list of outcome types per panel:
\code{"SURVIVAL"} or \code{"COMPETING-RISK"}. If \code{NULL}, each panel is inferred from
its \code{code.events} length (2 = SURVIVAL; 3 = COMPETING-RISK).}

\item{code.events}{A list of numeric vectors per panel.
For SURVIVAL: \code{c(event.code1, censor.code)};
for COMPETING-RISK: \code{c(event.code1, event.code2, censor.code)}.}

\item{type.x}{Reserved for future x-scale control (currently ignored).}

\item{type.y}{Optional vector/list per panel: \code{NULL} (survival) or \code{"risk"} (1-survival).}

\item{label.x, label.y}{Optional vectors/lists of axis labels per panel.}

\item{label.strata}{Optional list of character vectors for legend labels per panel
(passed to \code{\link{cifplot}}).}

\item{limits.x, limits.y}{Optional vectors/lists of numeric length-2 axis limits per panel.}

\item{break.x, break.y}{Optional vectors/lists of axis breaks per panel (forwarded to
\code{breaks.x} / \code{breaks.y} in \code{\link{cifplot}}).}

\item{addConfidenceInterval, addCensorMark, addCompetingRiskMark, addIntercurrentEventMark, addQuantileLine}{Optional logical vectors/lists per panel to toggle features in \code{\link{cifplot}}.
If \code{NULL}, sensible defaults are used (CI/Censor on; others off).}

\item{rows.columns.panel}{Integer vector \code{c(nrow, ncol)} specifying the grid size.}

\item{title.panel, subtitle.panel, caption.panel}{Optional strings for panel annotation.}

\item{tag_levels.panel}{Passed to \code{patchwork::plot_annotation(tag_levels = ...)}.}

\item{title.plot}{Optional length-2 character vector, titles for base/inset plots when
\code{use_inset_element = TRUE}.}

\item{legend.position}{Position of legends: \code{"top"}, \code{"right"}, \code{"bottom"},
\code{"left"}, or \code{"none"}.}

\item{legend.collect}{If \code{TRUE} (grid mode), collect legends across subplots.}

\item{use_inset_element}{If \code{TRUE}, place the second plot as an inset over the first.}

\item{inset.left, inset.bottom, inset.right, inset.top}{Numeric positions (0–1) of the inset box.}

\item{inset.align_to}{One of \code{"panel"}, \code{"plot"}, or \code{"full"}.}

\item{inset.legend.position}{Legend position for the inset plot (e.g., \code{"none"}).}

\item{print.panel}{If \code{TRUE}, print the composed panel.}

\item{filename.ggsave}{Optional file path to save the composed panel.}

\item{width.ggsave, height.ggsave, dpi.ggsave}{Size parameters for saving; if width/height
are \code{NULL}, defaults depend on grid size or inset mode.}

\item{...}{Additional arguments forwarded to \code{\link{cifplot}} (e.g., \code{style},
\code{font.family}, \code{font.size}, etc.). Panel-wise overrides provided via explicit
arguments take precedence over \code{...}.}
}
\value{
An invisible list: \code{list(plots = <list of ggplot objects>, out_patchwork = <patchwork object>)}.
}
\description{
Build a panel of publication-ready time-to-event plots by combining
\code{\link{cifcurve}} (estimation) and \code{\link{cifplot}} (rendering).
Supports grid layout or an inset plot overlay. Panel-wise overrides for
y-scale type, labels, limits, and various plot decorations are supported.
}
\details{
\strong{How it works:}
For each panel slot, the function first calls \code{\link{cifcurve}} to obtain
a \code{survfit}-like object, and then calls \code{\link{cifplot}} to render it.
You can pass \code{code.events = list(c(e1, e2, c), ...)} for competing risks
(Aalen–Johansen), or \code{code.events = list(c(e1, c), ...)} for standard
survival (Kaplan–Meier). If \code{outcome.type} is not specified, each panel's
outcome is inferred from the length of its \code{code.events[[i]]}.

\strong{Grid vs inset:}
\itemize{
\item \code{use_inset_element = FALSE} (default): arrange plots in a grid using
\pkg{patchwork} \code{wrap_plots()}. With \code{legend.collect = TRUE}, legends are
collected across panels.
\item \code{use_inset_element = TRUE}: overlay the second plot into the first one using
\code{patchwork::inset_element()}. Only the first two plots are used; extra plots are ignored.
}

\strong{Notes:}
\itemize{
\item \code{type.x} is reserved for future x-scale control (currently not applied).
\item If both \code{formula} and \code{formulas} are provided, the latter takes precedence.
}
}
\examples{
cifpanel(
  title.panel = "A comparison of cumulative incidence of competing events",
  rows.columns.panel = c(1,2),
  formula = Event(t, epsilon) ~ fruitq,
  data = diabetes.complications,
  outcome.type = "COMPETING-RISK",
  code.events = list(c(1,2,0), c(2,1,0)),
  label.y = c("Diabetic retinopathy", "Macrovascular complications"),
  label.x = "Years from registration",
  subtitle.panel = "Stratified by fruit intake",
  caption.panel  = "Data: diabetes.complications",
  title.plot = c("Diabetic retinopathy", "Macrovascular complications"),
  legend.position = "bottom",
  legend.collect=TRUE
)
cifpanel(
  title.plot = c("Associations between fruit intake and macrovascular complications", "Details"),
  use_inset_element = TRUE,
  formula = Event(t, epsilon) ~ fruitq,
  data = diabetes.complications,
  outcome.type = "COMPETING-RISK",
  code.events = list(c(2,1,0), c(2,1,0)),
  label.y = c("Macrovascular complications", ""),
  label.x = c("Years from registration", ""),
  limits.y     = list(c(0,1), c(0,0.15)),
  inset.left   = 0.40, inset.bottom = 0.45,
  inset.right  = 1.00, inset.top    = 0.95,
  inset.align_to = "plot",
  inset.legend.position = "none",
  legend.position = "bottom"
)
\dontrun{
data(diabetes.complications)
ce <- list(c(1, 2, 0), c(1, 2, 0), c(1, 0)) # 2 AJ panels + 1 KM panel
cifpanel(
  formulas = list(Event(t,epsilon)~fruitq, Event(t,epsilon)~sex, Surv(t, epsilon==1)~fruitq),
  data = diabetes.complications,
  code.events = ce,
  rows.columns.panel = c(1, 3),
  legend.collect = TRUE,
  title.panel = "CIF and survival panels"
)
}

}
\seealso{
\code{\link{cifcurve}}, \code{\link{cifplot}}
}
