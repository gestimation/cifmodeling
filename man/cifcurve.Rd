% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cifcurve.R
\name{cifcurve}
\alias{cifcurve}
\title{Calculate the Kaplan–Meier estimator and the Aalen–Johansen estimator}
\usage{
cifcurve(
  formula,
  data,
  weights = NULL,
  subset.condition = NULL,
  na.action = na.omit,
  outcome.type = c("SURVIVAL", "COMPETING-RISK"),
  code.event1 = 1,
  code.event2 = 2,
  code.censoring = 0,
  error = NULL,
  conf.type = "arcsine-square root",
  conf.int = 0.95,
  report.survfit.std.err = FALSE,
  engine = c("auto", "calculateKM", "calculateAJ", "calculateAJ_Rcpp"),
  return_if = FALSE
)
}
\arguments{
\item{formula}{A model formula specifying the time-to-event outcome on the
left-hand side (typically \code{Event(time, status)} or \code{Surv(time, status)})
and, optionally, a stratification variable on the right-hand side.
Unlike \code{\link{cifplot}}, this function does not accept a fitted
\code{survfit} object.}

\item{data}{A data frame containing variables in the formula.}

\item{weights}{Optional name of the weight variable in \code{data}. Weights must be nonnegative.}

\item{subset.condition}{Optional character expression to subset \code{data} before analysis.}

\item{na.action}{Function to handle missing values (default: \code{na.omit}).}

\item{outcome.type}{Character string specifying the type of time-to-event outcome.
One of \code{"SURVIVAL"} (Kaplan–Meier type) or \code{"COMPETING-RISK"} (Aalen–Johansen type).
If \code{NULL} (default), the function automatically infers the outcome type from the data:
if the event variable has more than two unique levels, \code{"COMPETING-RISK"} is assumed;
otherwise, \code{"SURVIVAL"} is used. You can also use abbreviations such as \code{"S"} or \code{"C"}.
Mixed or ambiguous inputs (e.g., \code{"c("S", "C")"} trigger automatic detection based on the event coding.}

\item{code.event1}{Integer code of the event of interest.}

\item{code.event2}{Integer code of the competing event.}

\item{code.censoring}{Integer code of censoring.}

\item{error}{Character specifying the method for variance and standard error  used internally.}

\item{conf.type}{Character specifying the method of transformation for confidence intervals  used internally.}

\item{conf.int}{Numeric two-sided confidence level  (default \code{0.95}).}

\item{report.survfit.std.err}{Logical. If \code{TRUE}, standard errors are
reported on the \emph{log-survival} scale, matching \code{survfit()}'s
default behaviour. If \code{FALSE} (default), SEs are on the probability
scale, which is often more convenient when displaying CIFs.}

\item{engine}{Character. One of \code{"auto"}, \code{"calculateKM"}, \code{"calculateAJ"}, or \code{"calculateAJ_Rcpp"}. Default \code{"auto"}
selects \code{"calculateKM"} for survival curves and \code{"calculateAJ_Rcpp"} for competing risks. \code{"calculateKM"} does not support CIF estimation.}

\item{return_if}{Logical. When \code{TRUE} and \code{engine = "calculateAJ_Rcpp"}, the influence function is also computed and returned.
Default \code{FALSE}.}
}
\value{
A \code{survfit} object. For \code{outcome.type="SURVIVAL"}, \code{$surv} is the survival function.
For \code{outcome.type="COMPETING-RISK"}, \code{$surv} equals \code{1 - CIF} for \code{code.event1}.
Standard error and CIs are provided per \code{conf.type}. Note that some methods for \code{survfit} (e.g., \code{residuals.survfit}) may not be supported.
}
\description{
Core estimation routine that computes a \code{survfit}-compatible object
from a formula + data interface (\code{Event()} or \code{Surv()} on
the left-hand side, and a stratification variable on the right-hand side if necessary).
Use this when you want \strong{numbers only} (KM / CIF + SE + CI) and
you will plot it yourself (for example with \code{ggsurvfit} or \code{\link{cifplot}}).

\strong{Outcome type and estimator}
\itemize{
\item \code{outcome.type = "SURVIVAL"} → Kaplan–Meier estimator
\item \code{outcome.type = "COMPETING-RISK"} → Aalen–Johansen estimator
}

\strong{Confidence intervals}
\itemize{
\item \code{conf.int} sets the two-sided level (default 0.95)
\item \code{conf.type} chooses the transformation (\code{"arcsin"}, \code{"plain"}, \code{"log"}, \code{"log-log"}, \code{"logit"}, or \code{"none"})
\item \code{error} chooses the estimator for standard error (\code{"greenwood"} or \code{"tsiatis"} for survival curves and \code{"delta"} or \code{"aalen"} for CIFs)
}
}
\details{
\itemize{
\item When \code{outcome.type = "SURVIVAL"}, this is a thin wrapper around KM with the
chosen variance / CI transformation.
\item When \code{outcome.type = "COMPETING-RISK"}, this computes the Aalen–Johansen
cumulative incidence for \code{code.event1}. The returned \code{$surv} is
\code{1 - CIF}, i.e. in the format that \pkg{ggsurvfit} expects.
\item Use \code{\link{cifplot}} if you want to go straight to a figure; use
\code{cifcurve()} if you only want the numbers.
}
\subsection{Standard error and confidence intervals}{\tabular{lll}{
   Argument \tab Description \tab Default \cr
   \code{error} \tab Standard error for KM: \code{"greenwood"}, \code{"tsiatis"}. For CIF: \code{"aalen"}, \code{"delta"}, \code{"none"}. \tab \code{"greenwood"} or \code{"delta"} \cr
   \code{conf.type} \tab Transformation for confidence intervals: \code{"plain"}, \code{"log"}, \code{"log-log"}, \code{"arcsin"}, \code{"logit"}, or \code{"none"}. \tab \code{"arcsin"} \cr
   \code{conf.int} \tab Two-sided confidence interval level. \tab \code{0.95} \cr
}

}
}
\examples{
data(diabetes.complications)
out_cifcurve <- cifcurve(Event(t,epsilon) ~ fruitq,
                         data = diabetes.complications,
                         outcome.type='COMPETING-RISK')
cifplot(out_cifcurve,
        outcome.type = "COMPETING-RISK",
        type.y = "risk",
        addRiskTable = FALSE,
        label.y = "CIF of diabetic retinopathy",
        label.x = "Years from registration")

}
\seealso{
\code{\link[=polyreg]{polyreg()}} for log-odds product modeling of CIFs; \code{\link[=cifplot]{cifplot()}} for display of a CIF; \code{\link[=cifpanel]{cifpanel()}} for display of multiple CIFs; \link[ggsurvfit:ggsurvfit]{ggsurvfit::ggsurvfit}, \link[patchwork:patchwork-package]{patchwork::patchwork} and \link[modelsummary:modelsummary]{modelsummary::modelsummary} for display helpers.
}
