% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cifcurve.R
\name{cifcurve}
\alias{cifcurve}
\title{Visualize time-to-event outcomes and intercurrent events}
\usage{
cifcurve(
  formula,
  data,
  weights = NULL,
  subset.condition = NULL,
  na.action = na.omit,
  code.event1 = 1,
  code.event2 = 2,
  code.censoring = 0,
  outcome.type = "SURVIVAL",
  conf.int = 0.95,
  error = "greenwood",
  conf.type = "arcsine-square root",
  report.survfit.std.err = FALSE,
  report.ggsurvfit = TRUE,
  ggsurvfit.type = NULL,
  addConfidenceInterval = TRUE,
  addRiskTable = TRUE,
  addCensorMark = TRUE,
  addIntercurrentEventMark = TRUE,
  label.x = "Time",
  label.y = "Survival probability",
  label.strata = NULL,
  lims.x = NULL,
  lims.y = c(0, 1),
  shape.censor.mark = 3,
  size.censor.mark = 2,
  intercurrent.event.time = NULL,
  shape.intercurrent.event.mark = 16,
  size.intercurrent.event.mark = 2,
  font.family = "sans",
  font.size = 14,
  legend.position = "top",
  filename = NULL
)
}
\arguments{
\item{formula}{A model formula specifying the outcome and (optionally) \code{strata()}.}

\item{data}{A data frame containing variables in \code{formula}.}

\item{weights}{Optional name of the weight variable in \code{data}. Weights must be nonnegative; strictly positive is recommended.}

\item{subset.condition}{Optional character expression to subset \code{data} before analysis.}

\item{na.action}{Function to handle missing values (default: \code{\link[stats]{na.omit}}).}

\item{code.event1}{Integer code of the event of interest (default \code{1}).}

\item{code.event2}{Integer code of the competing event (default \code{2}).}

\item{code.censoring}{Integer code of censoring (default \code{0}).}

\item{outcome.type}{\code{"SURVIVAL"} (KM) or \code{"COMPETING-RISK"} (AJ).}

\item{conf.int}{Two-sided confidence level (default \code{0.95}).}

\item{error}{Character specifying variance type used internally.
For \code{"SURVIVAL"} typically \code{"greenwood"}; for \code{"COMPETING-RISK"} pass options supported by \code{calculateAalenDeltaSE()} (e.g., \code{"aalen"}, \code{"delta"}, \code{"none"}).}

\item{conf.type}{Transformation for CI on the probability scale (default \code{"arcsine-square root"}).}

\item{report.survfit.std.err}{If \code{TRUE}, report SE on the log-survival scale (survfit's convention). Otherwise SE is on the probability scale.}

\item{report.ggsurvfit}{If \code{TRUE} (default), draw a \pkg{ggsurvfit} plot.}

\item{ggsurvfit.type}{\code{NULL} (survival) or \code{"risk"} (display \code{1 - survival} i.e. CIF).}

\item{addConfidenceInterval}{Logical add \code{add_confidence_interval()} to plot (default \code{TRUE}).}

\item{addRiskTable}{Logical add \code{add_risktable(risktable_stats="n.risk")} to plot (default \code{TRUE}).}

\item{addCensorMark}{Logical add \code{add_censor_mark()} to plot (default \code{TRUE}).}

\item{addIntercurrentEventMark}{Logical; overlay user-specified time marks per strata (default \code{TRUE}).}

\item{label.x}{Axis labels (defaults: \code{"Time"}).}

\item{label.y}{Axis labels (defaults: \code{"Survival probability"}).
If \code{ggsurvfit.type="risk"} and \code{label.y} is unchanged, it is internally set to \code{"1 - survival probability"}.}

\item{label.strata}{Character vector of labels for strata.}

\item{lims.x}{Numeric length-2 vectors for axis limits (defaults: \code{NULL}, \code{c(0,1)}).}

\item{lims.y}{Numeric length-2 vectors for axis limits (defaults: \code{NULL}, \code{c(0,1)}).}

\item{shape.censor.mark}{Integer point shape for censor marks (default \code{3}).}

\item{size.censor.mark}{Numeric point size for censor marks (default \code{2}).}

\item{intercurrent.event.time}{Named list of numeric vectors (names must match or be mapped to strata labels).}

\item{shape.intercurrent.event.mark}{Integer point shape for intercurrent-event marks (default \code{16}).}

\item{size.intercurrent.event.mark}{Numeric point size for intercurrent-event marks (default \code{2}).}

\item{font.family}{Character plot theme controls (defaults: \code{"sans"}).}

\item{font.size}{Integer plot theme controls (defaults: \code{14}).}

\item{legend.position}{Legend position: \code{"top"}, \code{"right"}, \code{"bottom"}, \code{"left"}, or \code{"none"} (default \code{"top"}).}

\item{filename}{Character specify the name of the graph output.}
}
\value{
A \code{survfit} object. For \code{outcome.type="SURVIVAL"}, \code{$surv} is the survival function.
For \code{outcome.type="COMPETING-RISK"}, \code{$surv} equals \code{1 - CIF} for \code{code.event1}.
Standard error and CIs are provided per \code{conf.type}. Note that some methods for \code{survfit} (e.g., \code{residuals.survfit}) may not be supported.
}
\description{
Estimate and plot survival curves using the Kaplan–Meier estimator or
cumulative incidence curves under competing risks using the Aalen–Johansen estimator.
Returns a \code{survfit}-compatible object and, by default, draws a publication-ready plot via \pkg{ggsurvfit}.
}
\details{
\strong{Estimation:}
\itemize{
\item \code{outcome.type = "SURVIVAL"}: Kaplan–Meier estimator with Greenwood-type variance.
\item \code{outcome.type = "COMPETING-RISK"}: Aalen–Johansen estimator for CIF of \code{code.event1}
using IPCW for the censoring distribution. The returned \code{surv} corresponds to \code{1 - CIF}.
}
\strong{Confidence intervals:}
Constructed on the probability scale with the specified \code{conf.type}.
If \code{conf.type \%in\% c("none","n")}, the plot suppresses CI bands.

\strong{Plotting:}
By default, the function calls an internal helper \code{call_ggsurvfit()} which adds
confidence bands, risk table, censoring marks, and optional intercurrent-event marks.
For CIF display, set \code{ggsurvfit.type = "risk"}.
}
\examples{
data(diabetes.complications)
survfit_by_group <- cifcurve(Event(t,epsilon) ~ fruitq, data = diabetes.complications,
                    outcome.type='COMPETING-RISK', error='delta', ggsurvfit.type = 'risk',
                    label.y = 'CIF of diabetic retinopathy', label.x = 'Years from registration')

}
\seealso{
\code{\link{polyreg}} for log-odds product models of CIFs; \pkg{ggsurvfit} for plotting helpers.
}
