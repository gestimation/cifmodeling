---
title: "Direct polytomous regression"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Direct polytomous regression}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

<!-- badges: start --> <!-- badges: end -->

## Model specification

The model for `polyreg()` is specified by three main components:

-   Nuisance model: Describes the relationship between outcomes and covariates (excluding exposure).

-   Effect measures and time points: Defines the exposure effect to be estimated and the time point of interest.

-   Censoring adjustment: Specifies strata for inverse probability weighting to adjust for dependent censoring.

## 1. Nuisance Model

The `nuisance.model` argument specifies the formula linking the outcome to covariates. Its format depends on the outcome type:

-   Competing risks or survival outcome: Use `Surv()` or `Event()` with time and status variables.

-   Binomial outcome: Use standard R formula notation.

Default event codes:

-   Competing risks outcome: 1 and 2 for event types, 0 for censoring.

-   Survival outcome: 1 for events, 0 for censoring.

-   Binomial outcome: 0 and 1.

Event codes can be customized using `code.event1`, `code.event2`, and `code.censoring`. The `outcome.type` argument must be set to:

-   Effects on cumulative incidence probabilities at a specific time: `"COMPETING-RISK"`

-   Effects on a risk at a specific time: `"SURVIVAL"`

-   Common effects on cumulative incidence probabilities over time: `"PROPORTIONAL-COMPETING-RISK"`

-   Common effects on a risk over time: `"PROPORTIONAL-SURVIVAL"`

-   Effects on a risk of a binomial outcome: `"BINOMIAL"`

Covariates included in `nuisance.model` should adjust for confounding factors to obtain unbiased exposure effect estimates.

## 2. Effect measures and time points

Three effect measures available:

-   Risk ratio (RR)

-   Odds ratio (OR)

-   Subdistribution hazard ratio (SHR)

Set the desired measure using `effect.measure1` and, for competing risks analysis, `effect.measure2`. The `time.point` argument specifies the follow-up time at which effects are estimated. 

## 3. Censoring adjustment

Inverse probability weights adjust for dependent censoring. Use `strata=` to specify stratification variables. If no strata are specified, Kaplan-Meier weights are used.

## Confidence intervals

By default, `polyreg()` chooses a single, simple confidence interval method based on `outcome.type`:

-   `"COMPETING-RISK"`, `"SURVIVAL"`, `"BINOMIAL"` — Wald CIs based on sandwich variance
-   `"PROPORTIONAL-COMPETING-RISK"`, `"PROPORTIONAL-SURVIVAL"` — Bootstrap CIs (normal approximation)

For time-point (non-proportional) models, the default is Wald confidence intervals using a sandwich variance directly from influence functions. If `report.boot.conf = TRUE`, the variance is instead estimated by a wild (multiplier) bootstrap applied to the influence functions (`boot.multiplier`, boot.replications), and Wald confidence intervals are formed from that bootstrap variance. For common effects (proportional models), `boot()` refits the estimator in each replicate and forms normal-approximate confidence intervals from the bootstrap mean and SD. If desired, BCa confidence intervals can be requested via `boot.bca = TRUE` (only for proportional models). Users normally do not need to set any confidence interval flags. 

## Return

This function returns a list object that includes:

-   `coefficient` — regression coefficients

-   `cov` — variance-covariance matrix for regression coefficients

-   `diagnostic.statistics` — a data frame containing inverse probability weights, influence functions, and predicted potential outcomes

-   `summary` — a summary of estimated exposure effects

Use `summary` output with `msummary()` to display formatted results. The regression coefficients and their variance-covariance matrix are provided as `coefficient` and `cov`, respectively, with the first element corresponding to the intercept term, subsequent elements to the covariates in `nuisance.model`, and the last element to the variable specified by `exposure=`. Finally, `diagnostic.statistics` is a data frame containing inverse probability weights, influence functions, and predicted values of the potential outcomes of individual observations. 
